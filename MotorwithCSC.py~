#!/usr/bin/env python3
import RPi.GPIO as GPIO
import sys
import time
from bluepy.btle import DefaultDelegate
from bluepy.btle import Peripheral
from bluepy import btle
import sys
from Modele import cscsensor

def convertCSCtoSpeed(CSC):
    '''30km/h is 340w'''
    return CSC*100/30.0 
    
peripheral = Peripheral("d8:e3:66:b3:b9:95",btle.ADDR_TYPE_RANDOM)
delegate = cscsensor.DelegateForCSC()
peripheral.withDelegate(delegate)
peripheral.writeCharacteristic(12,(1).to_bytes(2, byteorder='little'))
speed = 0
motor = MotorDriver(pin1,pin2)

def getspeed():
    try:
        while delegate.flag:
            if peripheral.waitForNotifications(10):
                speed = convertCSCtoSpeed(delegate.speed)
                continue
            break
    except:
        print("disconnected")
    finally:
        peripheral.disconnect()
        sys.exit(0)



    

    
th1_getspeed = threading.Thread(name="getspeed",target=getspeed,args=None)
